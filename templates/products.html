<!DOCTYPE html>
<html>
<head>
    <title>Products</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <style>
        .product-img {
            height: 200px;
            width: 100%;
            object-fit: cover;
        }

        #suggestions {
            top: 100%;
        }
    </style>
</head>
<body class="p-4">
    <div class="container position-relative">
        <h2 class="mb-4">Product List</h2>

        <!-- Search Bar -->
        <form method="get" action="{{ url_for('index') }}" class="form-inline mb-4 position-relative">
            <input type="text" id="searchInput" name="q" class="form-control mr-2 w-75" placeholder="Search products..." autocomplete="off" value="{{ request.args.get('q', '') }}">
            <button type="submit" class="btn btn-outline-primary">Search</button>
            <div id="suggestions" class="list-group position-absolute w-75" style="z-index: 1000;"></div>
        </form>

        {% if products %}
            <div class="row">
                {% for product in products %}
                    <div class="col-md-4 mb-4">
                        <div class="card h-100 shadow-sm">
                            {% if product.ImageURL %}
                            <img src="{{ product.ImageURL }}" class="card-img-top product-img" alt="{{ product.Name }}">
                            {% endif %}
                            <div class="card-body">
                                <h5 class="card-title">{{ product.Name or 'Unnamed Product' }}</h5>
                                {% if product.Brand %}
                                    <p class="card-text"><strong>Brand:</strong> {{ product.Brand }}</p>
                                {% endif %}
                                {% if product.price %}
                                    <p class="card-text"><strong>Price:</strong> ${{ product.price }}</p>
                                {% endif %}
                                <a href="{{ url_for('product_detail', product_id=product._id) }}" class="btn btn-primary">View Details</a>
                            </div>
                        </div>
                    </div>
                {% endfor %}
            </div>
        {% else %}
            <p class="text-muted">No products found.</p>
        {% endif %}

        <div class="d-flex justify-content-center mt-4">
            {{ pagination.links }}
        </div>

        <!-- Link to the Chatbot -->
        <div class="text-center mt-4">
            <a href="{{ url_for('chat') }}" class="btn btn-info">Chat with our Bot</a>
        </div>
    </div>

    <!-- Autocomplete Script -->
    <script>
    $(document).ready(function () {
        $('#searchInput').on('input', function () {
            let query = $(this).val();
            if (query.length < 1) {
                $('#suggestions').empty();
                return;
            }

            $.get('/suggest', { q: query }, function (data) {
                let suggestionBox = $('#suggestions');
                suggestionBox.empty();
                data.forEach(function (item) {
                    suggestionBox.append(`<a href="#" class="list-group-item list-group-item-action">${item}</a>`);
                });
            });
        });

        $('#suggestions').on('click', 'a', function (e) {
            e.preventDefault();
            $('#searchInput').val($(this).text());
            $('#suggestions').empty();
        });

        $(document).on('click', function (e) {
            if (!$(e.target).closest('#searchInput, #suggestions').length) {
                $('#suggestions').empty();
            }
        });
    });
    </script>
</body>
</html>
